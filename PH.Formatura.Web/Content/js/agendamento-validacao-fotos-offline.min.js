var oValidacaoOffline={jqThis:null,oPhotos:null,oSwiper:null,objControl:null,oProduto:null,oGRD_ORDER_PRODUCT_PHOTOS:[],oListaProductGroup:[],evento_click:"click",evento_mousedown:"mousedown",evento_mouseup:"mouseup",evento_contextmenu:"contextmenu",evento_touchend:"touchend",evento_wheel:"wheel",seletor_geral:"body",seletor_foto_selecionar:".cont-foto li:not(.grid-sizer)",seletor_foto_selecionar_img:".cont-foto li img",seletor_foto_filtro:".resumo-fotos a",seletor_btn_eu_quero:".btn-eu-quero",seletor_btn_view_thumb:"#btn-view-thumb",seletor_btn_view_big:"#btn-view-big",seletor_btn_view_flip:"#btn-view-flip",seletor_btn_change_view:".dvImageView a",seletor_foto_selecionar_view_big:".swiper-wrapper .swiper-slide .cont-img",seletor_foto_selecionar_view_big_img:".swiper-wrapper .swiper-slide .cont-img img",seletor_nome_produto:"#NomeProduto",seletor_qtd_min:"#QtdMinFoto",seletor_qtd_max:"#QtdMaxFoto",seletor_fotos_all:"#fotos_all",seletor_fotos_selecionadas:"#fotos_selecionadas",seletor_fotos_excluidas:"#fotos_excluidas",seletor_fotos_excluidas_percent:"#fotos_excluidas_percent",seletor_resumo:".resumo-fotos",select_view_fotos:"#view-thumb-foto",seletor_btn_fechar:".btnFechar",seletor_thumbs:".thumbs",seletor_bg_hold_preview:".bg-hold-preview",seletor_div_fechar_hold_preview:".div-fechar-hold-preview",seletor_view_thumb_foto:"#view-thumb-foto",seletor_swiper_container:".swiper-container",seletor_btn_carrousel_next:".btn-carrousel-next",seletor_btn_carrousel_prev:".btn-carrousel-prev",seletor_hold_preview:".hold-preview",seletor_all_img:"img",filtro:"todas",limit_percent_discart:0,percent_atual:0,viewType:"thumb",urlRender:"",token:"",delayFotos:800,_fotos_excluidas_qtd:0,_fotos_selecionadas_qtd:0,url_api_select_photo:(oGeral.string_url_base_aplicacao||oInicial.BaseUrlAplicacao)+"/api/Agendamento/SelectPhoto",albumIDCript:"",url_api_go_to_cart:(oGeral.string_url_base_aplicacao||oInicial.BaseUrlAplicacao)+"/api/Agendamento/GoToCart",alunoTurmaID:0,productID:0,qtdMinFoto:0,qtdMaxFoto:0,urlRetorno:(oGeral.string_url_base_aplicacao||oInicial.BaseUrlAplicacao)+"/Offline/Produtos",NomeProduto:"",LoadInit:function(){var n=oValidacaoOffline,i,t;if(n.objControl=sessionStorage.getItem(oOffline.cookie_validacao_fotos),n.objControl==null||n.objControl==undefined){oUtil.ShowModalError("objControl","Informações de carregamento da página não encontrados");return}n.objControl=JSON.parse(n.objControl);n.objControl.AlunoTurmaID=parseInt(n.objControl.AlunoTurmaID);n.urlRetorno=n.objControl.url_retorno;i=dbControl.GRD_AlunoTurma_Photos.Name;t=[];dbControl.SelectALL(i,function(i){var r,u;if(i==null||i.length==0){oUtil.ShowModalError("AlunoTurma_Photos","AlunoTurma_Photos não encontrado");return}for(r=0;r<i.length;r++)u=i[r],u.AlunoTurmaID==n.objControl.AlunoTurmaID&&t.push(u);if(t.length==0){oUtil.ShowModalError("AlunoTurma_Photos","AlunoTurma_Photos não encontrado para esse aluno");return}n.LoadPhotos(t)})},LoadPhotos:function(n){var t=oValidacaoOffline,i;t.oPhotos=[];i=dbControl.Photos_Album.Name;dbControl.SelectALL(i,function(i){var u,r,f,e;if(i==undefined||i==undefined||i.length==0){oUtil.ShowModalError("Photos_Album","Photos_Album sem registros");return}for(u=0;u<i.length;u++)r=i[u],f=t.GetFoto(n,r.PhotoID,n.length),f!=null&&(r.Selected=!1,r.itemOrder=f.itemOrder,t.oPhotos.push(r));if(t.oPhotos.length==0){oUtil.ShowModalError("Photos_Album","Photos nao encontradas");return}t.oPhotos=oUtil.SortByInt(t.oPhotos,!0,"itemOrder");e=dbControl.GRD_ORDER_PRODUCT_PHOTOS.Name;dbControl.SelectALL(e,function(n){var i=t.objControl;n!=null&&n!=undefined&&n.length>0&&t.Load_ORDER_PRODUCT_PHOTOS(n,t.objControl.ProductID,t.objControl.AlunoTurmaID);t.Carregar(t.oPhotos,"","",i.AlunoTurmaID_Cript,i.AlunoTurmaID,i.ProductID,i.PercentualDescarte,i.QtdMinFoto,i.QtdMaxFoto,i.NomeProduto,i.isFirstAcess);setTimeout(oValidacaoOffline.RefatoraIsotope,t.delayFotos+1)})})},Load_ORDER_PRODUCT_PHOTOS:function(n,t,i){var f=oValidacaoOffline,u,r;for(f.oGRD_ORDER_PRODUCT_PHOTOS=[],u=0;u<n.length;u++)r=n[u],i==r.AlunoTurmaID&&t==r.ProductID&&r.OrderID==null&&f.oGRD_ORDER_PRODUCT_PHOTOS.push(r)},GetFoto:function(n,t,i){for(var u,f=null,r=0;r<i;r++)if(u=n[r],u.PhotoID==t){f=u;break}return f},SelecionaFotosInit:function(n,t,i,r,u){for(var c,o,l,f=oValidacaoOffline,h=n.length,s=t.length,e=0;e<s;e++)c=t[e],o=f.GetFoto(n,c.PhotoID,h),o!=null&&(o.Selected=!0);if(u>0&&s==0)for(e=0;e<h;e++)o=n[e],o.Selected=e<i?!0:!1;l={AlbumIDCript:f.albumIDCript,AlunoTurmaID:f.alunoTurmaID,ProductID:f.productID,QtdMinFoto:f.qtdMinFoto,QtdMaxFoto:f.qtdMaxFoto,fotos:n};s==0?f.SelectPhotoIndexDB(l,null,null,null,null,null,null,f.AtualizaHtml):f.AtualizaHtml()},ExibeFotosHtml:function(n){var r=oValidacaoOffline,u=r.jqThis.find(r.select_view_fotos),f=n.length,i,t;for(u.append('<li class="grid-sizer"><\/li>'),i=0;i<f;i++)t=n[i],u.append('<li id="'+t.PhotoIDCript+'"> <img class="thumbs '+(t.Width>=t.Height?"thumb_h":"thumb_v")+(t.Selected?" selecionado":" nao-selecionado")+'" alt="'+t.Nome+'" title="'+t.Nome+'" src="data:image/jpg;base64,'+t.RenderMain+'" photoid="'+t.PhotoIDCript+'"> <\/li>')},Carregar:function(n,t,i,r,u,f,e,o,s,h,c){var l=oValidacaoOffline;l.jqThis=jQuery(l.seletor_geral);l.oPhotos=n;l.urlRender=t;l.token=i;l.albumIDCript=r;l.alunoTurmaID=u;l.productID=f;l.limit_percent_discart=e;l.qtdMinFoto=parseInt(o);l.qtdMaxFoto=parseInt(s);l.NomeProduto=h;l.isFirstAcess=c;l.isFirstAcess?l.jqThis.find(l.seletor_nome_produto).html("Seleção de fotos para álbum"):l.jqThis.find(l.seletor_nome_produto).html("Produto: "+l.NomeProduto);$(l.seletor_qtd_min).html(l.qtdMinFoto);$(l.seletor_qtd_max).html(l.qtdMaxFoto);l.jqThis.find(l.seletor_fotos_all).html(l.oPhotos.length);l.SelecionaFotosInit(l.oPhotos,l.oGRD_ORDER_PRODUCT_PHOTOS,l.qtdMaxFoto,l.qtdMinFoto,l.limit_percent_discart)},AtualizaHtml:function(){var n=oValidacaoOffline;n.ExibeFotosHtml(n.oPhotos);n.CalculaResumo(n.oPhotos);n.qtdMinFoto==n.qtdMaxFoto?n.jqThis.find(n.seletor_resumo).hide():n.jqThis.find(n.seletor_resumo).show();n.jqThis.length&&n.CarregarEventos();oUtil.ShowLoader(!1);oTurn.mIniciar()},CarregarEventos:function(){var n=oValidacaoOffline;$(n.seletor_foto_filtro).on(n.evento_click,function(){return n.ShowFotos(this),n.TratarCliqueAncorasResumoFotos(this),!1});$(n.seletor_btn_eu_quero).on(n.evento_click,function(t){return n.EuQuero(t,this),!1});$(n.seletor_btn_change_view).on(n.evento_click,function(t){return n.ChangeView(t,$(this).attr("data-view-type").toLowerCase()),!1});$(n.seletor_btn_fechar).on(n.evento_click,function(t){return n.ChangeView(t,"thumb"),!1});$(n.seletor_view_thumb_foto).isotope({itemSelector:"li",percentPosition:!0});$(n.seletor_foto_selecionar).on(n.evento_click,function(t){return n.SelecionarFoto(t,this),!1});$(n.seletor_all_img).on(n.evento_contextmenu,function(t){n.TratarOnContextMenu(t)});$(n.seletor_thumbs).on(n.evento_touchend,function(t){n.TratarTouchEndThumbs(t)});$(n.seletor_thumbs).longTouch(function(t,i){return n.TratarLongTouch(t,i)},125);$(n.seletor_swiper_container).on(n.evento_wheel,function(t){n.TratarRolada(t)})},TratarOnContextMenu:function(n){return n.preventDefault(),!1},TratarRolada:function(n){var t=oValidacaoOffline;$(n.originalEvent.wheelDelta/120>0?t.seletor_btn_carrousel_prev:t.seletor_btn_carrousel_next).trigger(t.evento_click)},TratarTouchEndThumbs:function(){var n=this;$(n.seletor_hold_preview).promise().done(function(){$(n.seletor_div_fechar_hold_preview).click()})},TratarCliqueAncorasResumoFotos:function(n){var t=oValidacaoOffline;oValidacaoOffline.RefatoraIsotope();$("."+t.string_active+"[filtro]").not(n).removeClass(t.string_active);$(n).addClass(t.string_active)},TratarLongTouch:function(n,t){var i=oValidacaoOffline,s,h,o,f,e,r,u,c,l;$(i.seletor_hold_preview).remove();$(i.seletor_bg_hold_preview).remove();s=$(t.target).clone();s.on(i.evento_contextmenu,function(n){return i.TratarOnContextMenu(n)});return h=$('<div class="bg-hold-preview"><\/div>'),o=$('<div class="hold-preview"><\/div>'),$("body").append(o),$(o).append(s),$(o).css({position:"fixed",width:t.target.width+"px",height:t.target.height+"px",left:t.target.x+"px",top:t.target.y-Number($(t.target).css("margin-top").replace("px",""))+(t.target.width>t.target.height?Number($(t.target).css("margin-top").replace("px","")):0)+"px","z-index":11,"border-width":0,"border-color":"#fff","border-style":"solid",opacity:$(t.target).closest("li").css("opacity"),"-moz-opacity":$(t.target).closest("li").css("-moz-opacity"),filter:$(t.target).closest("li").css("filter")}),f=40,n[0].innerWidth>t.target.height?(e=t.target.width/t.target.height,u=Number((n[0].innerWidth-f*2).toFixed(2)),r=Number((u/e).toFixed(2)),n[0].innerHeight-r<f&&(r=Number((n[0].innerHeight-f*2).toFixed(2)),u=Number((r*e).toFixed(2)))):(e=t.target.height/t.target.width,r=Number((n[0].innerHeight-f*2).toFixed(2)),u=Number((r*e).toFixed(2)),n[0].innerWidth-u<f&&(u=Number((n[0].innerWidth-f*2).toFixed(2)),r=Number((u/e).toFixed(2)))),c=Number(n[0].innerHeight-r)/2,l=Number(n[0].innerWidth-u)/2,$(o).animate({width:u+"px",height:r+"px",left:l+"px",top:c+"px",borderWidth:"10px",opacity:1,"-moz-opacity":1,filter:"alpha(opacity=100)"},150,function(){$(this).append('<div class="div-fechar-hold-preview"><div class="glyphicon glyphicon-remove-sign"><\/div><\/div>');$("body").append(h);var n={width:t.target.width+"px",height:t.target.height+"px",left:t.target.x+"px",top:t.target.y-Number($(t.target).css("margin-top").replace("px",""))+(t.target.width>t.target.height?Number($(t.target).css("margin-top").replace("px","")):0)+"px",borderWidth:0};$(i.seletor_div_fechar_hold_preview).on(i.evento_click,function(t){t.preventDefault();i.TratarCliqueDivFecharHoldPreview(n)});$(i.seletor_bg_hold_preview).unbind().on(i.evento_click,function(n){n.preventDefault();$(i.seletor_div_fechar_hold_preview).trigger(i.evento_click)})}),!1},TratarCliqueDivFecharHoldPreview:function(n){var t=oValidacaoOffline;$(t.seletor_div_fechar_hold_preview).remove();$(t.seletor_bg_hold_preview).remove();$(t.seletor_hold_preview).animate(n,150,function(){$(this).fadeOut(function(){$(this).remove()})})},CalculaResumo:function(n){for(var e,o,t=oValidacaoOffline,f=n.length,r=0,i=0,u=0;u<f;u++)e=n[u],e.Selected?r++:i++;var s=t.jqThis.find(t.seletor_fotos_selecionadas),h=t.jqThis.find(t.seletor_fotos_excluidas),c=t.jqThis.find(t.seletor_fotos_excluidas_percent);s.html(r);h.html(i);t._fotos_excluidas_qtd=i;t._fotos_selecionadas_qtd=r;o=t.CalculaPercent(i,f);t.percent_atual=o;c.html(t.percent_atual+"%")},GetoPhotosById:function(n){for(var i,r=oValidacaoOffline,u=null,t=0;t<r.oPhotos.length;t++)if(i=r.oPhotos[t],n==i.PhotoIDCript){u=i;break}return u},GetoPhotosByFilter:function(n){for(var t,u=oValidacaoOffline,i=[],r=0;r<u.oPhotos.length;r++){t=u.oPhotos[r];switch(n.toLowerCase()){case"todas":i.push(t);break;case"selecionadas":t.Selected&&i.push(t);break;case"excluidas":t.Selected||i.push(t)}}return i},ShowFotos:function(n){var r=oValidacaoOffline,t=n!=undefined?$(n):$(r.seletor_foto_filtro+'[filtro="todas"]'),f=t.length>0?t.attr("filtro"):"todas",u,i;r.filtro=f;u=r.oPhotos;r.jqThis.find(r.seletor_resumo).children().removeClass("active");t.addClass("active");switch(f){case"todas":for(i=0;i<u.length;i++)t=u[i],r.jqThis.find("#"+t.PhotoIDCript).show();break;case"selecionadas":for(i=0;i<u.length;i++)t=u[i],t.Selected?r.jqThis.find("#"+t.PhotoIDCript).show():r.jqThis.find("#"+t.PhotoIDCript).hide();break;case"excluidas":for(i=0;i<u.length;i++)t=u[i],t.Selected==!1?r.jqThis.find("#"+t.PhotoIDCript).show():r.jqThis.find("#"+t.PhotoIDCript).hide()}r.ReloadSwiper()},ChangeView:function(n,t){var i=oValidacaoOffline;$(i.seletor_btn_change_view).removeClass("active");t=="thumb"?($(i.seletor_btn_view_thumb).addClass("active"),$(i.seletor_swiper_container).hide(),$(oTurn.sContainerTurn).hide(),$("#section-principal").removeClass("swiper-ativo")):t=="big"?($(i.seletor_btn_view_big).addClass("active"),$(i.seletor_swiper_container).css("opacity",1).show(),$(oTurn.sContainerTurn).hide(),$("#section-principal").addClass("swiper-ativo"),i.ReloadSwiper()):t=="flip"&&($(i.seletor_btn_view_flip).addClass("active"),$("#section-principal").addClass("swiper-ativo"),$(oTurn.sContainerTurn).show(),oTurn.mReconfigurarTurn());i.AjustarMargemImgSwiper();i.viewType=t.toLowerCase()},AjustarMargemImgSwiper:function(){var n=oValidacaoOffline;$(n.seletor_foto_selecionar_view_big_img).each(function(){$(this).css("margin-top",(window.innerHeight-this.height)/2+"px")})},CriaSwiper:function(n){for(var f,t=oValidacaoOffline,e=$(t.seletor_swiper_container).find(".swiper-wrapper"),o=t.GetoPhotosByFilter(n),r=0;r<o.length;r++){var u="",i=o[r],s=e.find("#sw_"+i.PhotoIDCript);s.length==0?(u='<div class="swiper-slide" id="sw_'+i.PhotoIDCript+'"><div class="cont-img" photoid="'+i.PhotoIDCript+'"><img alt="'+i.Nome+'" title="'+i.Nome+'" src="data:image/jpg;base64,'+i.RenderMain+'" class="'+(i.Height>i.Width?"portrait":"landscape")+" "+(i.Selected?"selecionado":"nao-selecionado")+'" /> <div class="checks"><div class="check-img '+(i.Selected?"selecionado":"nao-selecionado")+'"><\/div> <div class="no-check-img '+(i.Selected?"nao-selecionado":"selecionado")+'"><\/div> <\/div><\/div><\/div>',t.oSwiper==null?e.append(u):t.oSwiper.appendSlide(u)):(f=s.find("img"),i.Selected?f.removeClass("nao-selecionado").addClass("selecionado").parent().addClass("selecionado"):f.removeClass("selecionado").addClass("nao-selecionado").parent().removeClass("selecionado"))}t.jqThis.find(t.seletor_swiper_container+" "+t.seletor_all_img).on(t.evento_contextmenu,function(n){t.TratarOnContextMenu(n)});if(t.oSwiper==null){t.oSwiper=new Swiper(t.seletor_swiper_container,{nextButton:t.seletor_btn_carrousel_next,prevButton:t.seletor_btn_carrousel_prev,spaceBetween:30});t.jqThis.on(t.evento_click,t.seletor_foto_selecionar_view_big,function(n){return t.SelecionarFotoSwiper(n,this),!1})}},ReloadSwiper:function(){var n=oValidacaoOffline;n.DestroySwiper();n.CriaSwiper(n.filtro)},DestroySwiper:function(){var n=oValidacaoOffline;n.oSwiper!=null&&n.oSwiper.removeAllSlides()},CompleteSelectFotos:function(n,t,i,r,u,f,e){var o=oValidacaoOffline,s,u,h,c,i,l,t;try{for(o.RecalculaResumo(!u.Selected,!0),s=0;s<n.fotos.length;s++)u=n.fotos[s],t=$(document.getElementById(u.PhotoIDCript)),h=oValidacaoOffline.jqThis.find("#sw_"+u.PhotoIDCript).find("img"),e=oValidacaoOffline.jqThis.find("#sw_"+u.PhotoIDCript).find(".check-img"),elementoImg2=oValidacaoOffline.jqThis.find("#sw_"+u.PhotoIDCript).find(".no-check-img"),c=oValidacaoOffline.GetoPhotosById(u.PhotoIDCript),i=t.find("img"),o.filtro!="selecionadas"||u.Selected?o.filtro=="excluidas"&&u.Selected&&(t.hide(o.delayFotos),o._fotos_excluidas_qtd==0&&setTimeout("oValidacaoOffline.ShowFotos()",800)):t.hide(o.delayFotos),u.Selected?(i.removeClass("nao-selecionado").addClass("selecionado"),e.removeClass("nao-selecionado").addClass("selecionado"),i.addClass("selecionado"),elementoImg2.removeClass("selecionado").addClass("nao-selecionado"),h.removeClass("nao-selecionado").addClass("selecionado"),c.Selected=!0):(i.removeClass("selecionado").addClass("nao-selecionado"),e.removeClass("selecionado").addClass("nao-selecionado"),i.removeClass("selecionado"),elementoImg2.removeClass("nao-selecionado").addClass("selecionado"),h.removeClass("selecionado").addClass("nao-selecionado"),c.Selected=!1),o.oSwiper!=null&&o.filtro!="todas"&&(l=o.oSwiper.activeIndex,t=o.jqThis.find("#sw_"+r),(o.filtro=="selecionadas"||o.filtro=="excluidas")&&(t.hide(o.delayFotos),setTimeout("oValidacaoOffline.oSwiper.removeSlide("+l+")",800)));oUtil.ShowLoader(!1);o.oSwiper!=null&&o.filtro!="todas"&&setTimeout(oValidacaoOffline.RefatoraIsotope,o.delayFotos+1)}catch(a){oUtil.ShowLoader(!1);oUtil.ShowModalError("","Erro no metodo CompleteSelectFotos erro: "+a)}},SelectPhotoIndexDB:function(n,t,i,r,u,f,e,o){var s=oValidacaoOffline,c,v,l;try{oUtil.ShowLoader(!0);var y=s.oGRD_ORDER_PRODUCT_PHOTOS.length,p=s.objControl,a=dbControl.GRD_ORDER_PRODUCT_PHOTOS.Name,w=n.fotos.length,h=[];for(c=0;c<w;c++)v=n.fotos[c],l={AlunoTurmaID:p.AlunoTurmaID,ProductID:p.ProductID,PhotoID:v.PhotoID,OrderID:null},v.Selected==!0?(y++,l.ID=y,h.push(l)):dbControl.DeleteByIndexComplex(a,l,function(h,c){if(h==undefined||h==!1){oUtil.ShowLoader(!1);oUtil.ShowModalError("","Erro ao deletar "+l);return}if(c+1==w){var l=dbControl.GRD_ORDER_PRODUCT_PHOTOS.Name;dbControl.SelectALL(l,function(h){s.Load_ORDER_PRODUCT_PHOTOS(h,s.objControl.ProductID,s.objControl.AlunoTurmaID);o!=undefined?o():s.CompleteSelectFotos(n,t,i,r,u,f,e)})}},c);h.length>0&&dbControl.InsertArray(a,h,function(c){if(c==undefined||c==!1){oUtil.ShowLoader(!1);oUtil.ShowModalError("","Erro ao inserir "+a);return}for(var l=0;l<h.length;l++)s.oGRD_ORDER_PRODUCT_PHOTOS.push(h[l]);o!=undefined?o():s.CompleteSelectFotos(n,t,i,r,u,f,e)})}catch(b){oUtil.ShowLoader(!1);oUtil.ShowModalError("","Erro no metodo SelectPhotoIndexDB erro: "+b)}},DoSelecionarFoto:function(n){var t=oValidacaoOffline,e=$("#div-limite-fotos-modal");e.modal("hide");var r=jQuery("#"+n),o=r.find("img"),u=r.attr("id"),i=t.GetoPhotosById(u),f=t.jqThis.find("#sw_"+u),s=f.find("img"),h={AlbumIDCript:t.albumIDCript,AlunoTurmaID:t.alunoTurmaID,ProductID:t.productID,QtdMinFoto:t.qtdMinFoto,QtdMaxFoto:t.qtdMaxFoto,fotos:[{PhotoID:i.PhotoID,Selected:!i.Selected,PhotoIDCript:i.PhotoIDCript}]};t.SelectPhotoIndexDB(h,r,o,u,i,f,s,undefined)},RefatoraIsotope:function(){var n=oValidacaoOffline;$(n.seletor_view_thumb_foto).isotope()},SelecionarFoto:function(n,t){var i=oValidacaoOffline,o=$(t),f=o.attr("id"),u=i.GetoPhotosById(f),e,r;if(u.Selected==!0&&parseInt(i.qtdMinFoto)>0&&i._fotos_selecionadas_qtd-1<parseInt(i.qtdMinFoto)&&(r=$("#div-min-fotos-modal"),r.modal()),u.Selected==!1&&parseInt(i.qtdMaxFoto)>0&&i._fotos_selecionadas_qtd+1>parseInt(i.qtdMaxFoto)&&(r=$("#div-max-fotos-modal"),r.modal()),e=i.RecalculaResumo(!u.Selected,!1),!e&&u.Selected==!0){r=$("#div-limite-fotos-modal");r.find(".btn-ok").unbind(i.evento_click);r.find(".btn-ok").on(i.evento_click,function(){return oValidacaoOffline.DoSelecionarFoto(f),!1});r.modal();return}i.DoSelecionarFoto(f)},SelecionarFotoSwiper:function(n,t){var i=oValidacaoOffline,r=t.getAttribute("photoid"),u=i.SelecionarFoto(n,document.getElementById(r))},CalculaPercent:function(n,t){return Math.round(n/t*100)},RecalculaResumo:function(n,t){var i=oValidacaoOffline,o=i.jqThis.find(i.seletor_fotos_selecionadas),s=i.jqThis.find(i.seletor_fotos_excluidas),h=i.jqThis.find(i.seletor_fotos_excluidas_percent),c=parseInt(i.jqThis.find(i.seletor_fotos_all).html()),r=parseInt(s.html()),u=parseInt(o.html()),f,e;return n!=undefined&&(n?(r-=1,u+=1):(r+=1,u-=1)),f=i.CalculaPercent(r,c),e=!1,e=f/100>i.limit_percent_discart&&i.limit_percent_discart>0?!1:!0,t==!0&&(i.percent_atual=f,s.html(r),o.html(u),h.html(i.percent_atual+"%"),i._fotos_excluidas_qtd=r,i._fotos_selecionadas_qtd=u),e},EuQuero:function(){var n=oValidacaoOffline,t;if(n.qtdMinFoto>0&&n._fotos_selecionadas_qtd<n.qtdMinFoto)return t=$("#div-min-fotos-modal"),t.modal(),!1;if(n.qtdMaxFoto>0&&n._fotos_selecionadas_qtd>n.qtdMaxFoto){t=$("#div-max-fotos-modal");t.modal();return}n.SelectPhotosGroupProduct()},SelectPhotosGroupProduct:function(){var n=oValidacaoOffline,i,t;try{oUtil.ShowLoader(!0);i=dbControl.v_GRD_Products.Name;t=[];dbControl.SelectALL(i,function(r){var f,u;if(r==null||r==undefined||r.length==0){oUtil.ShowModalError("","Erro ao recuperar info "+i+" SelectPhotosGroupProduct");return}for(f=0;f<r.length;f++)u=r[f],n.objControl.Grupo==u.Grupo&&n.objControl.ProductID!=u.ProductID&&t.push(u),n.objControl.Grupo==u.Grupo&&n.oListaProductGroup.push(u);t.length==0?n.RedirectUrlRetorno():n.DeletePhotosProduct(t,n.objControl.AlunoTurmaID)})}catch(r){oUtil.ShowModalError("","Erro no metodo SelectPhotosGroupProduct erro: "+r)}},DeletePhotosProduct:function(n,t){var f=oValidacaoOffline,i,u;try{var e=dbControl.GRD_ORDER_PRODUCT_PHOTOS.Name,o=[],r=0;for(i=0;i<n.length;i++)o.push(n[i].ProductID),u={ProductID:n[i].ProductID,AlunoTurmaID:t},dbControl.DeleteByHintIndexComplex(e,"ProductIDAlunoTurmaID",u,function(t){if(r++,t&&r>=n.length){f.CopySelectPhotosGroupProductArray(n);return}})}catch(s){oUtil.ShowModalError("","Erro no metodo DeletePhotosProduct erro: "+s)}},CopySelectPhotosGroupProduct:function(n,t,i,r,u){var f=oValidacaoOffline,o,s,i,h,e;try{if(o=dbControl.GRD_ORDER_PRODUCT_PHOTOS.Name,r==u&&(t++,r=0),t==i){s=0;i=f.oListaProductGroup.length;f.AtualizaCartProducts(s,i);return}h=n[t];e=f.oGRD_ORDER_PRODUCT_PHOTOS[r];e.ID=(t+1)*u+(r+1);e.ProductID=h.ProductID;dbControl.Insert(o,e,function(r,u){if(r==!1){oUtil.ShowModalError("","Erro ao inserir registro info "+o+" CopySelectPhotosGroupProduct");return}u++;f.CopySelectPhotosGroupProduct(n,t,i,u,f.oGRD_ORDER_PRODUCT_PHOTOS.length)},r)}catch(c){oUtil.ShowModalError("","Erro no metodo CopySelectPhotosGroupProduct erro: "+c)}},clone:function(n){var i,t;if(null==n||"object"!=typeof n)return n;i=n.constructor();for(t in n)n.hasOwnProperty(t)&&(i[t]=n[t]);return i},CopySelectPhotosGroupProductArray:function(n){var t=oValidacaoOffline,i,r,u;try{var f=dbControl.GRD_ORDER_PRODUCT_PHOTOS.Name,o=t.oGRD_ORDER_PRODUCT_PHOTOS.length,e=[];for(i=0;i<n.length;i++)for(r=0;r<t.oGRD_ORDER_PRODUCT_PHOTOS.length;r++)u=t.clone(t.oGRD_ORDER_PRODUCT_PHOTOS[r]),u.ProductID=n[i].ProductID,u.ID=(i+1)*o+(r+1),e.push(u);dbControl.InsertArray(f,e,function(n,i){if(n==!1){oUtil.ShowModalError("","Erro ao inserir registro info "+f+" CopySelectPhotosGroupProductArray. "+i.target.error);return}t.AtualizaCartProducts(0,t.oListaProductGroup.length)},0)}catch(s){oUtil.ShowModalError("","Erro no metodo CopySelectPhotosGroupProductArray erro: "+s)}},AtualizaCartProducts:function(n,t){var i,r,u;if(_this=oValidacaoOffline,i=oOffline.getCookie(cookie_user_name),i=JSON.parse(i),n==t){_this.RedirectUrlRetorno();return}r=_this.oListaProductGroup[n].ProductID;u={AlunoTurmaID:Number(_this.objControl.AlunoTurmaID),ProductID:Number(r),UserID:Number(i.User_ID)};dbControl.SelectByIndexComplex(dbControl.GRD_CART_PRODUCT.Name,u,function(u){if(u&&u.length>0)u[0].QtdFoto=_this._fotos_selecionadas_qtd,dbControl.UpdateByIndexComplex(dbControl.GRD_CART_PRODUCT.Name,u[0],function(n,i){i++;_this.AtualizaCartProducts(i,t)},n);else{var f={AlunoTurmaID:Number(_this.objControl.AlunoTurmaID),ProductID:Number(r),UserID:Number(i.User_ID),QtdFoto:_this._fotos_selecionadas_qtd,Qtd:1};n++;_this.AtualizaCartProducts(n,t)}})},RedirectUrlRetorno:function(){var n=oValidacaoOffline,t,i,r;if(oUtil.ShowLoader(!0),t=oOffline.getCookie(cookie_user_name),t=JSON.parse(t),i=n.objControl.ProductID,r={AlunoTurmaID:Number(n.objControl.AlunoTurmaID),ProductID:Number(i),UserID:Number(t.User_ID)},n.isFirstAcess){document.location.href=n.urlRetorno;return}dbControl.SelectByIndexComplex(dbControl.GRD_CART_PRODUCT.Name,r,function(r){if(r&&r.length>0)r[0].QtdFoto=n._fotos_selecionadas_qtd,dbControl.UpdateByIndexComplex(dbControl.GRD_CART_PRODUCT.Name,r[0],function(){document.location.href=n.urlRetorno});else{var u={AlunoTurmaID:Number(n.objControl.AlunoTurmaID),ProductID:Number(i),UserID:Number(t.User_ID),QtdFoto:n._fotos_selecionadas_qtd,Qtd:1};dbControl.Insert(dbControl.GRD_CART_PRODUCT.Name,u,function(){document.location.href=n.urlRetorno})}})}},oTurn={vImagens:[],oThis:null,oControleCliquePagina:0,eClick:"click",eTurned:"turned",sContainerTurn:".container-turn",sTurn:".turn",sPageWrapper:".page-wrapper",sBtnTurnNav:".btn-turn-nav",mIniciar:function(){var n=oTurn;n.oThis=$(n.sTurn);n.oThis.length&&(n.mCriarImagens(),n.mConfigurarTurn());window.screen.orientation.onchange=function(){oTurn.mReconfigurarTurn()};window.addEventListener("resize",function(){oTurn.mReconfigurarTurn()})},mCriarImagens:function(){var n=oTurn,r=oValidacaoOffline.oPhotos,u='<div class="page" {$style}><\/div>',t,i;if(r){for(t=0;t<r.length;t++)i=r[t],n.vImagens.push({orientation:i.Width>=i.Height?"thumb_h":"thumb_v",selected:i.Selected?" selecionado":" nao-selecionado",name:i.Nome,src:"data:image/jpg;base64,"+i.RenderMain,photoId:i.PhotoIDCript}),t==0?n.oThis.append('<div class="page" style="background-image: url(\'{$src}\');"><\/div>'.replace("{$src}",n.vImagens[t].src)):t==r.length-1?n.oThis.append(u.replace("{$style}",n.vImagens[t].bg?"style=\"background-image: url('"+n.vImagens[t].src+"');\"":"")):n.oThis.append('<div class="page" style="background-image: url(\'{$src}\');"><\/div>'.replace("{$src}",n.vImagens[t].src));r.length%2!=0&&n.oThis.append(u.replace("{$style}",""));n.mConfigurarListners()}},mConfigurarTurn:function(){var t=oTurn,u=0,n=1.5,i,r,f;window.innerWidth/n<=window.innerHeight-u?(i=(window.innerHeight-u)*n,r=i/n):(r=(window.innerWidth-u)/n,i=r*n);t.oThis.css({marginTop:f,acceleration:!0,gradients:!0});t.oThis.turn({width:i,height:r});f=(window.innerHeight-t.oThis.height())/2;t.oThis.css({marginTop:f})},mReconfigurarTurn:function(){var n=oTurn;n.oThis.turn("is")&&n.oThis.turn("destroy");n.mCriarImagens();n.mConfigurarTurn();n.mAdicionarClassesPageWrapper()},mAdicionarClassesPageWrapper:function(){var n=oTurn;$(n.sPageWrapper).removeClass("page-wrapper-par page-wrapper-impar").addClass(function(){return Number($(this).attr("page"))%2==0?"page-wrapper-par":"page-wrapper-impar"})},mConfigurarListners:function(){var n=oTurn;n.oThis.unbind(n.eTurned).on(n.eTurned,function(){n.mAdicionarClassesPageWrapper()});$(n.sBtnTurnNav).unbind(n.eClick).on(n.eClick,function(t){return t.preventDefault(),n.mTratarCliqueSetasNavegacao(this),!1})},mTratarCliqueSetasNavegacao:function(n){var t=oTurn;$(n).hasClass("next")?t.oThis.turn("next"):$(n).hasClass("previous")&&t.oThis.turn("previous")}};oOffline.verifyAcesso();dbControl.CallbackOpenOnSuccess=function(){oValidacaoOffline.LoadInit()};
/*
//# sourceMappingURL=agendamento-validacao-fotos-offline.min.js.map
*/