var oPedidosPendentes={jqThis:null,ListTipoPgto:[],StatusSync:[{id:1,name:"Pendente"},{id:2,name:"Sincronizado"},{id:3,name:"Erro"}],Orders_Pending:[],oOrderComplete:null,evento_click:"click",seletor_geral:".conteudo-geral",bootstrap_table:"#table-pedidos-list",btn_enviar_pedido:".btn-enviar-pedido",url_api_sync_pedido:(oGeral.string_url_base_aplicacao||oInicial.BaseUrlAplicacao)+"/api/Checkout/RegisterOrder",cookie_user_name:"",Carregar:function(n,t){var i=this;i.ListTipoPgto=n;i.cookie_user_name=t;i.jqThis=jQuery(i.seletor_geral);i.jqThis.length&&i.CarregarEventos()},CarregarEventos:function(){var n=this},GetAlunoTurmaID:function(n,t){return t.DadosPgto.alunoTurmaId},GetOrdersPending:function(n){for(var i,r=this,u=null,t=0;t<r.Orders_Pending.length;t++)if(i=r.Orders_Pending[t],n==i.ID){u=i;break}return u},TrataErroSync:function(n,t){var i=this;try{dataParsed=n;n.responseText!=undefined&&(dataParsed=JSON.parse(n.responseText));var u=dataParsed.erro_id!=undefined?dataParsed.erro_id:dataParsed.CodErro!=undefined?dataParsed.CodErro:"",r=dataParsed.Message!=undefined?dataParsed.Message:dataParsed.Mensagem,f=new Date,e=new pedidos_pendentes_error_cls(u,oUtil.FormatDate3(f),r);t.Erros.push(e);t.NumTentativasSync++;t.StatusSync=i.StatusSync[2].name;dbControl.UpdateByIndex(dbControl.Orders_Pending.Name,t.ID,t,function(t){t!=undefined&&t==!0?n.Sucesso==!1?oUtil.ShowModalError("",r):oUtil.ShowModalError("","",n):oUtil.ShowModalError("","Erro ao atualizar informacoes de erro");var u=$(i.bootstrap_table);u.bootstrapTable("load",i.Orders_Pending)})}catch(o){oUtil.ShowModalError("","Erro TrataErroSync "+o)}},CompleteSyncOrder:function(n){var t=this;n.NumTentativasSync++;n.StatusSync=t.StatusSync[1].name;n.DataConclusaoSync=oUtil.FormatDate3(new Date);dbControl.UpdateByIndex(dbControl.Orders_Pending.Name,n.ID,n,function(i){i!=undefined&&i==!0?oUtil.DeleteInfoIndexDB(parseInt(n.DadosPgto.alunoTurmaId),t.ShowMsgOkSyncPedido):oUtil.ShowModalError("","Erro ao processar sync")})},ShowMsgOkSyncPedido:function(){var n=oPedidosPendentes,t="Pedido sincronizado com sucesso.",i;n.oOrderComplete!=null&&n.oOrderComplete!=undefined&&n.oOrderComplete.code!=undefined&&(t+="<BR> Pedido número: "+n.oOrderComplete.code);oUtil.ShowModalGeral("<i class='material-icons ico-done'>done<\/i> ",t);i=$(n.bootstrap_table);i.bootstrapTable("load",n.Orders_Pending);n.oOrderComplete=null},SyncOrder:function(n){var t=this,i,r;if(!oOffline.CheckNetConnection()){oUtil.ShowModalError("","Não é possível sincronizar offline");return}if(i=t.GetOrdersPending(n),i==null||i.DadosPgto==null){oUtil.ShowModalError("","Não foi possível recuperar as informações do pedido id: "+n);return}t.oOrderComplete=null;r=i.DadosPgto;oUtil.ShowLoader(!0);$.ajax({url:t.url_api_sync_pedido,data:JSON.stringify(r),contentType:"application/json",method:"POST",headers:oUtil.GetToken()}).fail(function(n){t.TrataErroSync(n,i)}).done(function(n){n.Sucesso==!1?t.TrataErroSync(n,i):(t.oOrderComplete=n.Order,t.CompleteSyncOrder(i))}).always(function(){})},AtivaBtnEnviarPedido:function(n){return n=="pendente"||n=="erro"?!0:!1},BtnEnviarPedido:function(n,t){var f=oPedidosPendentes,i="#",r="mdl-button--disabled",u=t.StatusSync.toLowerCase();return f.AtivaBtnEnviarPedido(u)&&(i="javascript:oPedidosPendentes.SyncOrder("+t.ID+")",r=""),"<a href='"+i+"' status='"+u+"' class='mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--colored "+r+" btn-enviar-pedido'>Enviar Pedido<\/a>"},GetTipo:function(n,t){for(var f,e=oPedidosPendentes,r=e.ListTipoPgto,u="",o=t.DadosPgto.pagamento.tipoId,i=0;i<r.length;i++)f=r[i],o==r[i].id&&(u=f.desc);return u},GetValor:function(n,t){return t.DadosPgto.valorTotal}};oOffline.verifyAcesso();jQuery(document).ready(function(){oPedidosPendentes.Carregar(listTipoPgto,cookie_user_name)});oOffline.CallbackVerifyOnline=function(n){n==!0?$(oPedidosPendentes.btn_enviar_pedido).each(function(n,t){var r=oPedidosPendentes,i=$(t),u=i.attr("status").toLowerCase();r.AtivaBtnEnviarPedido(u)&&i.removeClass("mdl-button--disabled")}):$(oPedidosPendentes.btn_enviar_pedido).each(function(n,t){var i=$(t);i.addClass("mdl-button--disabled")})};dbControl.CallbackOpenOnSuccess=function(){var n=oPedidosPendentes;jQuery(document).ready(function(){var t=oOffline.getCookie(n.cookie_user_name);t=JSON.parse(t);dbControl.SelectALL(dbControl.Orders_Pending.Name,function(i){var f=[],r,u,e;if(i!=null&&i.length>0)for(r=0;r<i.length;r++)u=i[r],u.StatusSync.toLowerCase()!="sincronizado"&&u.DadosPgto.userId==t.User_ID&&f.push(u);n.Orders_Pending=f;e=$(oPedidosPendentes.bootstrap_table);e.bootstrapTable({data:f})})})};
/*
//# sourceMappingURL=pedidos-pendentes.min.js.map
*/